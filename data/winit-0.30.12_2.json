{
    "level": "Info",
    "analyzer": "UnsafeDataflow",
    "op_type": "Transmute",
    "description": "Potential unsafe dataflow issue in `platform_impl::linux::x11::event_processor::EventProcessor::xinput2_mouse_motion`",
    "file": "winit-0.30.12/src/platform_impl/linux/x11/event_processor.rs",
    "start_line": 1104,
    "start_col": 5,
    "end_line": 1180,
    "end_col": 6,
    "code_snippet": "fn xinput2_mouse_motion<T: 'static, F>(&self, event: &XIDeviceEvent, mut callback: F)\n    where\n        F: FnMut(&RootAEL, Event<T>),\n    {\n        let wt = Self::window_target(&self.target);\n\n        // Set the timestamp.\n        wt.xconn.set_timestamp(event.time as xproto::Timestamp);\n\n        let device_id = mkdid(event.deviceid as xinput::DeviceId);\n        let window = event.event as xproto::Window;\n        let window_id = mkwid(window);\n        let new_cursor_pos = (event.event_x, event.event_y);\n\n        let cursor_moved = self.with_window(window, |window| {\n            let mut shared_state_lock = window.shared_state_lock();\n            util::maybe_change(&mut shared_state_lock.cursor_pos, new_cursor_pos)\n        });\n\n        if cursor_moved == Some(true) {\n            let position = PhysicalPosition::new(event.event_x, event.event_y);\n\n            let event = Event::WindowEvent {\n                window_id,\n                event: WindowEvent::CursorMoved { device_id, position },\n            };\n            callback(&self.target, event);\n        } else if cursor_moved.is_none() {\n            return;\n        }\n\n        // More gymnastics, for self.devices\n        let mask = unsafe {\n            slice::from_raw_parts(event.valuators.mask, event.valuators.mask_len as usize)\n        };\n        let mut devices = self.devices.borrow_mut();\n        let physical_device = match devices.get_mut(&DeviceId(event.sourceid as xinput::DeviceId)) {\n            Some(device) => device,\n            None => return,\n        };\n\n        let mut events = Vec::new();\n        let mut value = event.valuators.values;\n        for i in 0..event.valuators.mask_len * 8 {\n            if !xinput2::XIMaskIsSet(mask, i) {\n                continue;\n            }\n\n            let x = unsafe { *value };\n\n            let event = if let Some(&mut (_, ref mut info)) =\n                physical_device.scroll_axes.iter_mut().find(|&&mut (axis, _)| axis == i as _)\n            {\n                let delta = (x - info.position) / info.increment;\n                info.position = x;\n                // X11 vertical scroll coordinates are opposite to winit's\n                let delta = match info.orientation {\n                    ScrollOrientation::Horizontal => {\n                        MouseScrollDelta::LineDelta(-delta as f32, 0.0)\n                    },\n                    ScrollOrientation::Vertical => MouseScrollDelta::LineDelta(0.0, -delta as f32),\n                };\n\n                WindowEvent::MouseWheel { device_id, delta, phase: TouchPhase::Moved }\n            } else {\n                WindowEvent::AxisMotion { device_id, axis: i as u32, value: unsafe { *value } }\n            };\n\n            events.push(Event::WindowEvent { window_id, event });\n\n            value = unsafe { value.offset(1) };\n        }\n\n        for event in events {\n            callback(&self.target, event);\n        }\n    }"
}