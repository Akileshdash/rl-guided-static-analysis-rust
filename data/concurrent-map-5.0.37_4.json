{
    "level": "Info",
    "analyzer": "UnsafeDataflow",
    "op_type": "Transmute",
    "description": "Potential unsafe dataflow issue in `ConcurrentMap::<K, V, FANOUT, LOCAL_GC_BUFFER_SIZE>::insert`",
    "file": "concurrent-map-5.0.37/src/lib.rs",
    "start_line": 1149,
    "start_col": 5,
    "end_line": 1209,
    "end_col": 6,
    "code_snippet": "pub fn insert(&self, key: K, value: V) -> Option<V> {\n        let strong_count = Arc::strong_count(&self.inner);\n        let direct_mutations_safe = strong_count == 1;\n\n        // This optimization allows us to completely skip RCU.\n        // We use the debug_delay here to exercise both paths\n        // even when testing with a single thread.\n        if direct_mutations_safe && !debug_delay() {\n            let mut guard = self.ebr.pin();\n            let mut leaf = self.inner.leaf_for_key(LeafSearch::Eq(&key), &mut guard);\n            let node_mut_ref: &mut Node<K, V, FANOUT> = unsafe { leaf.get_mut() };\n            assert!(!node_mut_ref.should_split(), \"bad leaf: should split\",);\n\n            let ret = node_mut_ref.insert(key, value);\n\n            if node_mut_ref.should_split() {\n                // don't need to track this for potential cleanup due to the fact that it's\n                // guaranteed to succeed.\n                node_mut_ref.split();\n            }\n\n            if ret.is_none() {\n                self.len.fetch_add(1, Ordering::Relaxed);\n            }\n\n            return ret;\n        }\n\n        // Concurrent workloads need to do the normal RCU loop.\n        loop {\n            let mut guard = self.ebr.pin();\n            let leaf = self.inner.leaf_for_key(LeafSearch::Eq(&key), &mut guard);\n\n            let mut leaf_clone: Box<Node<K, V, FANOUT>> = Box::new((*leaf).clone());\n            assert!(!leaf_clone.should_split(), \"bad leaf: should split\",);\n\n            let ret = leaf_clone.insert(key.clone(), value.clone());\n\n            let rhs_ptr_opt = if leaf_clone.should_split() {\n                Some(leaf_clone.split())\n            } else {\n                None\n            };\n\n            let install_attempt = leaf.cas(leaf_clone, &mut guard);\n\n            if install_attempt.is_ok() {\n                if ret.is_none() {\n                    self.len.fetch_add(1, Ordering::Relaxed);\n                }\n                return ret;\n            } else if let Some(new_ptr) = rhs_ptr_opt {\n                // clear dangling BoxedAtomicPtr (cas freed the pointee already)\n                let reclaimed_ptr: Box<AtomicPtr<Node<K, V, FANOUT>>> =\n                    unsafe { Box::from_raw(new_ptr.0 as *mut _) };\n\n                let _dropping_reclaimed_rhs: Box<Node<K, V, FANOUT>> =\n                    unsafe { Box::from_raw(reclaimed_ptr.load(Ordering::Acquire)) };\n            }\n        }\n    }"
}