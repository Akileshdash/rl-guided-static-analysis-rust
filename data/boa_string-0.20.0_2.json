{
    "level": "Warning",
    "analyzer": "UnsafeDestructor",
    "op_type": null,
    "description": "unsafe block detected in drop",
    "file": "boa_string-0.20.0/src/lib.rs",
    "start_line": 1021,
    "start_col": 1,
    "end_line": 1021,
    "end_col": 23,
    "code_snippet": "impl Drop for JsString {\n    #[inline]\n    fn drop(&mut self) {\n        if let UnwrappedTagged::Ptr(raw) = self.ptr.unwrap() {\n            // See https://doc.rust-lang.org/src/alloc/sync.rs.html#1672 for details.\n\n            // SAFETY:\n            // `NonNull` and the constructions of `JsString` guarantees that `raw` is always valid.\n            // And `Cell<usize>` is readable as an usize as long as we don't try to mutate the pointed variable,\n            // which means it is safe to read the `refcount` as `read_only` here.\n            let refcount = unsafe { (*raw.as_ptr()).refcount.read_only };\n            if refcount == 0 {\n                // Just a static string. No need to drop.\n                return;\n            }\n\n            // SAFETY: `NonNull` and the constructions of `JsString` guarantees that `raw` is always valid.\n            let inner = unsafe { raw.as_ref() };\n\n            // SAFETY:\n            // This has been checked aboved to ensure it is a `read_write` variant,\n            // which means it is safe to write the `refcount` as `read_write` here.\n            unsafe {\n                inner.refcount.read_write.set(refcount - 1);\n                if inner.refcount.read_write.get() != 0 {\n                    return;\n                }\n            }\n\n            // SAFETY:\n            // All the checks for the validity of the layout have already been made on `alloc_inner`,\n            // so we can skip the unwrap.\n            let layout = unsafe {\n                if inner.is_latin1() {\n                    Layout::for_value(inner)\n                        .extend(Layout::array::<u8>(inner.len()).unwrap_unchecked())\n                        .unwrap_unchecked()\n                        .0\n                        .pad_to_align()\n                } else {\n                    Layout::for_value(inner)\n                        .extend(Layout::array::<u16>(inner.len()).unwrap_unchecked())\n                        .unwrap_unchecked()\n                        .0\n                        .pad_to_align()\n                }\n            };\n\n            // SAFETY:\n            // If refcount is 0 and we call drop, that means this is the last `JsString` which\n            // points to this memory allocation, so deallocating it is safe.\n            unsafe {\n                dealloc(raw.as_ptr().cast(), layout);\n            }\n        }\n    }\n}"
}