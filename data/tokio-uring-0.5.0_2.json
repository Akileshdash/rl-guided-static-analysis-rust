{
    "level": "Warning",
    "analyzer": "UnsafeDestructor",
    "op_type": null,
    "description": "unsafe block detected in drop",
    "file": "tokio-uring-0.5.0/src/runtime/driver/mod.rs",
    "start_line": 378,
    "start_col": 1,
    "end_line": 378,
    "end_col": 21,
    "code_snippet": "impl Drop for Driver {\n    fn drop(&mut self) {\n        // get all ops in flight for cancellation\n        while !self.uring.submission().is_empty() {\n            self.submit().expect(\"Internal error when dropping driver\");\n        }\n\n        // Pre-determine what to cancel\n        // After this pass, all LifeCycles will be marked either as Completed or Ignored, as appropriate\n        for (_, cycle) in self.ops.lifecycle.iter_mut() {\n            match std::mem::replace(cycle, Lifecycle::Ignored(Box::new(()))) {\n                lc @ Lifecycle::Completed(_) => {\n                    // don't cancel completed items\n                    *cycle = lc;\n                }\n\n                Lifecycle::CompletionList(indices) => {\n                    let mut list = indices.clone().into_list(&mut self.ops.completions);\n                    if !io_uring::cqueue::more(list.peek_end().unwrap().flags) {\n                        // This op is complete. Replace with a null Completed entry\n                        // safety: zeroed memory is entirely valid with this underlying\n                        // representation\n                        *cycle = Lifecycle::Completed(unsafe { mem::zeroed() });\n                    }\n                }\n\n                _ => {\n                    // All other states need cancelling.\n                    // The mem::replace means these are now marked Ignored.\n                }\n            }\n        }\n\n        // Submit cancellation for all ops marked Ignored\n        for (id, cycle) in self.ops.lifecycle.iter_mut() {\n            if let Lifecycle::Ignored(..) = cycle {\n                unsafe {\n                    while self\n                        .uring\n                        .submission()\n                        .push(&AsyncCancel::new(id as u64).build().user_data(u64::MAX))\n                        .is_err()\n                    {\n                        self.uring\n                            .submit_and_wait(1)\n                            .expect(\"Internal error when dropping driver\");\n                    }\n                }\n            }\n        }\n\n        // Wait until all Lifetimes have been removed from the slab.\n        //\n        // Ignored entries will be removed from the Lifecycle slab\n        // by the complete logic called by `tick()`\n        //\n        // Completed Entries are removed here directly\n        let mut id = 0;\n        loop {\n            if self.ops.lifecycle.is_empty() {\n                break;\n            }\n            // Cycles are either all ignored or complete\n            // If there is at least one Ignored still to process, call wait\n            match self.ops.lifecycle.get(id) {\n                Some(Lifecycle::Ignored(..)) => {\n                    // If waiting fails, ignore the error. The wait will be attempted\n                    // again on the next loop.\n                    let _ = self.wait();\n                    self.dispatch_completions();\n                }\n\n                Some(_) => {\n                    // Remove Completed entries\n                    let _ = self.ops.lifecycle.remove(id);\n                    id += 1;\n                }\n\n                None => {\n                    id += 1;\n                }\n            }\n        }\n    }\n}"
}