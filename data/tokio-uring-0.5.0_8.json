{
    "level": "Info",
    "analyzer": "UnsafeDataflow",
    "op_type": "Transmute",
    "description": "Potential unsafe dataflow issue in `io::sendmsg_zc::<impl runtime::driver::op::Op<io::sendmsg_zc::SendMsgZc<T, U>, runtime::driver::op::MultiCQEFuture>>::sendmsg_zc`",
    "file": "tokio-uring-0.5.0/src/io/sendmsg_zc.rs",
    "start_line": 27,
    "start_col": 5,
    "end_line": 93,
    "end_col": 6,
    "code_snippet": "pub(crate) fn sendmsg_zc(\n        fd: &SharedFd,\n        io_bufs: Vec<T>,\n        socket_addr: Option<SocketAddr>,\n        msg_control: Option<U>,\n    ) -> io::Result<Self> {\n        use io_uring::{opcode, types};\n\n        let mut msghdr: Box<libc::msghdr> = Box::new(unsafe { std::mem::zeroed() });\n\n        let mut io_slices: Vec<IoSlice<'static>> = Vec::with_capacity(io_bufs.len());\n\n        for io_buf in &io_bufs {\n            io_slices.push(IoSlice::new(unsafe {\n                std::slice::from_raw_parts(io_buf.stable_ptr(), io_buf.bytes_init())\n            }))\n        }\n\n        msghdr.msg_iov = io_slices.as_ptr() as *mut _;\n        msghdr.msg_iovlen = io_slices.len() as _;\n\n        let socket_addr = match socket_addr {\n            Some(_socket_addr) => {\n                let socket_addr = Box::new(SockAddr::from(_socket_addr));\n                msghdr.msg_name = socket_addr.as_ptr() as *mut libc::c_void;\n                msghdr.msg_namelen = socket_addr.len();\n                Some(socket_addr)\n            }\n            None => {\n                msghdr.msg_name = std::ptr::null_mut();\n                msghdr.msg_namelen = 0;\n                None\n            }\n        };\n\n        match msg_control {\n            Some(ref _msg_control) => {\n                msghdr.msg_control = _msg_control.stable_ptr() as *mut _;\n                msghdr.msg_controllen = _msg_control.bytes_init();\n            }\n            None => {\n                msghdr.msg_control = std::ptr::null_mut();\n                msghdr.msg_controllen = 0_usize;\n            }\n        }\n\n        CONTEXT.with(|x| {\n            x.handle().expect(\"Not in a runtime context\").submit_op(\n                SendMsgZc {\n                    fd: fd.clone(),\n                    io_bufs,\n                    socket_addr,\n                    io_slices,\n                    msg_control,\n                    msghdr,\n                    bytes: 0,\n                },\n                |sendmsg_zc| {\n                    opcode::SendMsgZc::new(\n                        types::Fd(sendmsg_zc.fd.raw_fd()),\n                        sendmsg_zc.msghdr.as_mut() as *const _,\n                    )\n                    .build()\n                },\n            )\n        })\n    }"
}